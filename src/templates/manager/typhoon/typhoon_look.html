<html lang = "en">
<head>
    <meta charset = "utf-8">
    <meta content = "IE = edge" http-equiv = "X-UA-Compatible">
    <meta content = "width = device-width, initial-scale = 1" name = "viewport">
    <meta content = "" name = "description">
    <meta content = "" name = "author">
    <link href = "/static/plugins/images/favicon.png" rel = "icon" sizes = "16x16" type = "image/png">
    <title>TJtyphoons</title>
    <!-- Bootstrap Core CSS -->
    <link href = "/static/bootstrap/dist/css/bootstrap.min.css" rel = "stylesheet">
    <!-- Menu CSS -->
    <link href = "/static/plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.css" rel = "stylesheet">
    <!-- toast CSS -->
    <link href = "/static/plugins/bower_components/toast-master/css/jquery.toast.css" rel = "stylesheet">
    <!-- morris CSS -->
    <link href = "/static/plugins/bower_components/morrisjs/morris.css" rel = "stylesheet">
    <!-- animation CSS -->
    <link href = "/static/css/animate.css" rel = "stylesheet">
    <!-- Custom CSS -->
    <link href = "/static/css/style.css" rel = "stylesheet">
    <!-- color CSS -->
    <link href = "/static/css/colors/blue-dark.css" id = "theme" rel = "stylesheet">
    <link href = "/static/css/charts/chartist.min.css" rel = "stylesheet">
    <link href = "/static/assets/css/style.css" rel = "stylesheet">
    <link rel = "stylesheet" href = "/static/css/bootstrap-table.min.css">
</head>

<body class = "content-wrapper">
    <div class = "preloader" style = "display: none;">
        <div class = "cssload-speeding-wheel"></div>
    </div>

    <div id = "wrapper">
        <!-- 导航栏标签 -->
        <nav class = "navbar navbar-default navbar-static-top m-b-0">
            <!-- 导航栏头部 -->
            <div class = "navbar-header" style="background-color: #D7E4D3;">
                <a class = "navbar-toggle hidden-sm hidden-md hidden-lg " data-target = ".navbar-collapse" data-toggle = "collapse" href = "javascript:void(0)">
                    <i class = "fa fa-bars"></i>
                </a>
                <div class = "top-left-part">
                    <a href = "/manager/index"><b><img alt = "home" src = "/static/images/typhoon_logo.png"></b><span class = "hidden-xs" style = "display: none;"></span></a>
                </div>
                <ul class = "nav navbar-top-links navbar-right pull-right">
                    <!-- <li>
                        <a class = "profile-pic" href = "#">
                            <img alt = "user-img" class = "img-circle" src = "/static/plugins/images/users/IU.jpg" width = "64">
                            <b class = "hidden-xs"> </b>
                        </a>
                    </li> -->
                </ul>
            </div>
        </nav>
        <!-- 左部标签导航 -->
        <div class = "navbar-default sidebar" role = "navigation" style = "overflow: visible;">
            <div class = "slimScrollDiv" style = "position: relative; overflow: visible; width: auto; height: 100%;">
                <div class = "sidebar-nav navbar-collapse slimscrollsidebar"
                     style = "overflow: visible hidden; width: auto; height: 100%; background-color: #515c59;">
                    <ul class = "nav in" id = "side-menu">
                        <li style = "padding: 10px 0 0;">
                            <a class = "waves-effect" href = "/manager/index"><i aria-hidden = "true" class = "fa fa-home fa-fw"></i><span class = "hide-menu">主页</span></a>
                        </li>
                                              <!-- <li>
                            <a class = "waves-effect" href = "/"><i aria-hidden = "true" class = "fa fa-key fa-fw"></i><span class = "hide-menu">登录</span></a>
                        </li>
                        <li>
                            <a class = "waves-effect" href = "/register"><i aria-hidden = "true" class = "fa fa-bars fa-fw"></i><span class = "hide-menu">注册</span></a>
                        </li> -->
                        
                        <li id = "typhoonManage">
                            <a class = "waves-effect active" href = "#"><i aria-hidden = "true" class = "fa fa-anchor fa-fw"></i><span class = "hide-menu">台风管理</span></a>
                        </li>
                        <div id = "typhoon_manage">
                            <ul>
                                <li align = "center"><a class = "waves-effect" href = "/manager/typhoon/look"><span class = "hide-menu">台风编辑</span></a></li>
                                <li align = "center"><a class = "waves-effect" href = "/manager/typhoon/add"><span class = "hide-menu">台风增加</span></a></li>
                                <li align = "center"><a class = "waves-effect" href = "/manager/typhoon/delete"><span class = "hide-menu">台风删除</span></a></li>
                                <li align = "center"><a class = "waves-effect" href = "/manager/typhoon/query"><span class = "hide-menu">台风查询</span></a></li>
                            </ul>
                        </div>
                        <li id = "UserManage">
                            <a href = "#" class = "waves-effect"><i class = "fa fa-user fa-fw" aria-hidden = "true"></i><span class = "hide-menu">用户管理</span></a>
                        </li>
                        <div id = "user_manage" style = "display:none;">
                            <ul>
                                <li align = "center"><a class = "waves-effect" href = "/manager/user/add"><span class = "hide-menu">用户增加</span></a></li>
                                <li align = "center"><a class = "waves-effect" href = "/manager/user/delete"><span class = "hide-menu">用户删除</span></a></li>
                                <li align = "center"><a class = "waves-effect" href = "/manager/user/query"><span class = "hide-menu">用户查询</span></a></li>
                            </ul>
                        </div>
                        <li id = "NewsManage">
                            <a href = "/manager/news/main" class = "waves-effect"><i class = "fa fa-tencent-weibo-o fa-fw" aria-hidden = "true"></i><span class = "hide-menu">资讯管理</span></a>
                        </li>
                        <li>
                            <a class = "waves-effect" href = "/manager/hot/main"><i aria-hidden = "true" class = "fa fa-globe fa-fw"></i><span class = "hide-menu">登陆热度</span></a>
                        </li>

                        <li>
                            <a class = "waves-effect" href = "/logout"><i aria-hidden = "true" class = "fa fa-bell fa-fw"></i><span class = "hide-menu">登出</span></a>
                        </li>
                    </ul>
                </div>
                <div class = "slimScrollBar" style = "background: rgb(220, 220, 220); width: 0px; position: absolute; top: 0px; opacity: 0.4; display: none; border-radius: 7px; z-index: 99; right: 1px; height: 1775px;"></div>
                <div class = "slimScrollRail" style = "width: 0px; height: 100%; position: absolute; top: 0px; display: none; border-radius: 7px; background: rgb(51, 51, 51); opacity: 0.2; z-index: 90; right: 1px;"></div>
            </div>
        </div>


        <!-- Left navbar-header end -->
         <!-- 页面内容 -->
         <div id = "page-wrapper" style = "min-height: 692px; background-color: #f6f6f3;">

            <div class = "container-fluid">
                <div class = "row bg-title">
                    <div class = "col-lg-3 col-md-4 col-sm-4 col-xs-12">
                        <h4 class = "page-title">台风管理</h4>
                    </div>
                </div>

                <div class = "row">
                    <div class = "col-sm-12">
                        <div class = "white-box" id  =  "typhoon_info1">
                            <div>
                                <strong>信息概览</strong>
                                <div>
                                    <table class = "table table-striped table-bordered" id = "table"></table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- 编辑信息概览的模态框 -->
                <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editModalLabel">编辑信息概览</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="form-group">
                                        <label for="editTyphoonId">台风序号</label>
                                        <input type="text" class="form-control" id="editTyphoonId" disabled>
                                    </div>
                                    <div class="form-group">
                                        <label for="editTyphoonLocation">登陆地点</label>
                                        <input type="text" class="form-control" id="editTyphoonLocation">
                                    </div>
                                    <div class="form-group">
                                        <label for="editTyphoonTime">登陆时间</label>
                                        <input type="text" class="form-control" id="editTyphoonTime">
                                    </div>
                                    <div class="form-group">
                                        <label for="editTyphoonLon">台风经度</label>
                                        <input type="text" class="form-control" id="editTyphoonLon">
                                    </div>
                                    <div class="form-group">
                                        <label for="editTyphoonLat">台风纬度</label>
                                        <input type="text" class="form-control" id="editTyphoonLat">
                                    </div>
                                    <div class="form-group">
                                        <label for="editTyphoonCnt">台风热度</label>
                                        <input type="text" class="form-control" id="editTyphoonCnt" disabled>
                                    </div>
                                    
                                    <!-- 添加更多字段 -->
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                                <button type="button" class="btn btn-primary" onclick="saveChanges()">保存更改</button>
                            </div>
                        </div>
                    </div>
                </div>

                

            </div>
            <footer class = "footer text-center"> 2051454 © 王逸菲</footer>

        </div>
    </div>
    <!-- Wrapper end-->

    <!-- jQuery -->
    <script src = "/static/js/vendor/jquery-2.1.4.min.js"></script>
    <script src = "/static/js/popper.min.js"></script>
    <script src = "/static/js/main.js"></script>
    <script src = "/static/js/lib/data-table/buttons.bootstrap.min.js"></script>
    <script src = "/static/js/lib/data-table/jszip.min.js"></script>
    <script src = "/static/js/lib/data-table/vfs_fonts.js"></script>
    <script src = "/static/js/lib/data-table/buttons.html5.min.js"></script>
    <script src = "/static/js/lib/data-table/buttons.print.min.js"></script>
    <script src = "/static/js/lib/data-table/buttons.colVis.min.js"></script>
    <script src = "/static/js/lib/flot-chart/jquery.flot.js"></script>
    <script src = "/static/js/lib/flot-chart/jquery.flot.pie.js"></script>
    <script src = "/static/js/lib/flot-chart/jquery.flot.spline.js"></script>
    <script src = "/static/js/init/datatables-init.js"></script>
    <script src = "/static/js/lib/moment/moment.js"></script>
    <script src = "/static/js/lib/chart-js/Chart.bundle.js"></script>
    <script src = "/static/js/lib/chartist/chartist.min.js"></script>
    <script src = "/static/js/lib/chartist/chartist-plugin-legend.js"></script>
    <script src = "/static/plugins/bower_components/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src = "/static/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- Menu Plugin JavaScript -->
    <!--slimscroll JavaScript -->
    <script src = "/static/js/jquery.slimscroll.js"></script>
    <!--Wave Effects -->
    <script src = "/static/js/waves.js"></script>
    <!--Counter js -->
    <script src = "/static/plugins/bower_components/waypoints/lib/jquery.waypoints.js"></script>
    <script src = "/static/plugins/bower_components/counterup/jquery.counterup.min.js"></script>
    <!--Morris JavaScript -->
    <script src = "/static/plugins/bower_components/raphael/raphael-min.js"></script>
    <script src = "/static/plugins/bower_components/morrisjs/morris.js"></script>
    <!-- Custom Theme JavaScript -->
    <script src = "/static/js/custom.min.js"></script>
    <script src = "/static/js/dashboard1.js"></script>
    <script src = "/static/plugins/bower_components/toast-master/js/jquery.toast.js"></script>
    <script src = "/static/js/lib/data-table/datatables.min.js"></script>
    <script src = "/static/js/lib/data-table/dataTables.bootstrap.min.js"></script>
    <script src = "/static/js/lib/data-table/dataTables.buttons.min.js"></script>
    <script src = "/static/js/init/datatables-init.js"></script>
    <script src = "/static/plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.js"></script>
    <script type = "text/javascript">
        $(document).ready(function(){
            $('#typhoonManage').on('click',function(){
                $('#typhoon_manage').fadeToggle(300);
            });
            $('#UserManage').on('click',function(){
                $('#user_manage').fadeToggle(300);
            });
        });
    </script>
    <script src = "/static/js/bootstrap-table.min.js"></script>
    <script src = "/static/js/bootstrap-table-zh-CN.js"></script>
    <script type = "text/javascript">
        $(function(){
            // $('#table').bootstrapTable({
            // url: '/user/typhoon/typhoondata',
            // dataType: "json",
            // pagination: true,
            // cache: false,
            // pageNumber: 1,
            // pageSize: 10,
            // minimumCountColumns: 2,
            // sidePagination: "server",
            //     columns: [{
            //         field: 'typhoon_id',
            //         title: '台风序号',
            //         align: 'center',    //对齐方式，居中
            //     }, {
            //         field: 'typhoon_location',
            //         title: '登陆地点',
            //         align: 'center'
            //     }, {
            //         field: 'typhoon_cnt',
            //         title: '关注热度',
            //         align: 'center',
            //     }, {
            //         field: 'typhoon_time',
            //         title: '登陆时间',
            //         align: 'center',
            //     }, {
            //         field: 'typhoon_lon',
            //         title: '经度',
            //         align: 'center',
            //     }, {
            //         field: 'typhoon_lat',
            //         title: '纬度',
            //         align: 'center',
            //     }, {
            //         field: 'typhoon_status',
            //         title: '使用状态',
            //         align: 'center',
            //     }
            //     ],
            // });


            $('#table').bootstrapTable({
                url: '/manager/typhoon/typhoondata', // 数据源URL
                dataType: "json",
                pagination: true,
                pageNumber: 1,
                pageSize: 10,
                cache: false,
                sidePagination: "server",
                columns: [
                    { field: 'typhoon_id', title: '台风序号', align: 'center' },
                    { field: 'typhoon_location', title: '登陆地点', align: 'center' },
                    
                    { field: 'typhoon_time', title: '登陆时间', align: 'center' },
                    { 
                        field: 'typhoon_time', 
                        title: '登陆时间', 
                        align: 'center',
                        formatter: function(value, row, index) {
                            return formatDate(value);
                        }
                    },
                    { field: 'typhoon_lon', title: '经度', align: 'center' },
                    { field: 'typhoon_lat', title: '纬度', align: 'center' },
                    { field: 'typhoon_cnt', title: '关注热度', align: 'center' },
                   
                    {
                        field: 'action',
                        title: '操作',
                        align: 'center',
                        formatter: function(value, row, index) {
                            return '<button class="btn btn-primary" onclick="editRow(\'' + index + '\')">修改</button>';
                        }
                    }
                ]
            });

            // Function to format the date
            function formatDate(dateStr) {
                // Manually parse the date string
                var parts = dateStr.split(' ');
                var day = parts[1];
                console.log("1233333333333333",parts[2])
                var month = ('JanFebMarAprMayJunJulAugSepOctNovDec'.indexOf(parts[2]) / 3 + 1).toString().padStart(2, '0');
                var year = parts[3];
                var time = parts[4];

                // Return the formatted date string in the desired format
                return `${year}-${month}-${day} ${time}`;
            }


            // 编辑按钮点击事件
            window.editRow = function(index) {
                var rowData = $('#table').bootstrapTable('getData')[index];
                $('#editTyphoonId').val(rowData.typhoon_id);
                $('#editTyphoonLocation').val(rowData.typhoon_location);
                $('#editTyphoonTime').val(formatDate(rowData.typhoon_time));
                
                $('#editTyphoonLon').val(rowData.typhoon_lon);
                $('#editTyphoonLat').val(rowData.typhoon_lat);
                $('#editTyphoonCnt').val(rowData.typhoon_cnt);
                
                // 设置其他字段...
                $('#editModal').modal('show'); // 显示模态框
            };
           
            // 保存更改
            window.saveChanges = function() {
                var typhoonId = $('#editTyphoonId').val();
                var typhoonLocation = $('#editTyphoonLocation').val();
                var typhoonTime = $('#editTyphoonTime').val();
                var typhoonLon = $('#editTyphoonLon').val();
                var typhoonLat = $('#editTyphoonLat').val();
                var typhoonCnt = $('#editTyphoonCnt').val();

                //var typhoonTimeFormatted = new Date(typhoonTime).toISOString().slice(0, 19).replace('T', ' ');

                var data = {
                    typhoon_id: typhoonId,
                    typhoon_location: typhoonLocation,
                    typhoon_time: typhoonTime,
                    typhoon_lon: typhoonLon,
                    typhoon_lat: typhoonLat,
                    typhoon_cnt: typhoonCnt
                };

                // 在控制台打印出要发送的数据
                console.log('发送的数据:', data);
                // 获取其他字段...

                // 发送 AJAX 请求到服务器更新数据
                $.ajax({
                    url: '/manager/typhoon/update-typhoon-info', // 服务器端更新接口
                    dataType: "json",
                    method: 'POST',
                    contentType: 'application/json',  // 确保发送的内容类型为 JSON
                    data: JSON.stringify({  // 使用 JSON.stringify 来格式化数据为 JSON 字符串
                        typhoon_id: typhoonId,
                        typhoon_location: typhoonLocation,
                        typhoon_time: typhoonTime,
                        typhoon_lon: typhoonLon,
                        typhoon_lat: typhoonLat,
                        typhoon_cnt: typhoonCnt
                    }),
                   
                    success: function(response) {
                        alert('更新成功')
                        $('#editModal').modal('hide');
                        $('#table').bootstrapTable('refresh'); // 刷新表格
                    },
                    error: function() {
                        alert('更新失败');
                    }
                });
            };
        });

        
    </script>
</body>
</html>